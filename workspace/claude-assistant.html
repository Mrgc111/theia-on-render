<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Assistant for IDE</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 500;
        }
        
        .api-key-section {
            background-color: #34495e;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .api-key-section label {
            color: white;
            font-size: 14px;
        }
        
        .api-key-section input {
            flex: 1;
            min-width: 300px;
            padding: 8px 12px;
            border: 1px solid #555;
            border-radius: 4px;
            background-color: #2c3e50;
            color: white;
            font-family: monospace;
        }
        
        .api-key-section button {
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .api-key-section button:hover {
            background-color: #2980b9;
        }
        
        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid #ddd;
            overflow-y: auto;
        }
        
        .sidebar-section {
            border-bottom: 1px solid #eee;
        }
        
        .sidebar-section h3 {
            padding: 15px;
            background-color: #f8f9fa;
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }
        
        .sidebar-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px;
        }
        
        .sidebar-item:hover {
            background-color: #f0f0f0;
        }
        
        .sidebar-item.active {
            background-color: #e3f2fd;
            color: #1976d2;
            font-weight: 500;
        }
        
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .message-user .message-avatar {
            background-color: #3498db;
        }
        
        .message-assistant .message-avatar {
            background-color: #9b59b6;
        }
        
        .message-content {
            flex: 1;
        }
        
        .message-role {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #666;
        }
        
        .message-text {
            background-color: #f8f9fa;
            padding: 12px 16px;
            border-radius: 8px;
            line-height: 1.6;
        }
        
        .message-text pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .message-text code {
            background-color: #e8e8e8;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }
        
        .message-text pre code {
            background-color: transparent;
            padding: 0;
        }
        
        .input-container {
            border-top: 1px solid #ddd;
            padding: 20px;
            background-color: #fafafa;
        }
        
        .input-wrapper {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .input-wrapper textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            font-size: 14px;
        }
        
        .input-wrapper button {
            align-self: flex-end;
            padding: 12px 24px;
            background-color: #27ae60;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .input-wrapper button:hover {
            background-color: #229954;
        }
        
        .input-wrapper button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .code-editor {
            display: none;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .code-editor textarea {
            width: 100%;
            min-height: 300px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            background-color: white;
        }
        
        .code-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-message {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .copy-button {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .copy-button:hover {
            background-color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü§ñ Claude Assistant for IDE</h1>
    </div>
    
    <div class="api-key-section">
        <label for="apiKey">Anthropic API Key:</label>
        <input type="password" id="apiKey" placeholder="sk-ant-api03-..." />
        <button onclick="saveApiKey()">‰øùÂ≠ò</button>
        <button onclick="testApiKey()">Êé•Á∂ö„ÉÜ„Çπ„Éà</button>
        <span id="apiStatus" style="color: #ecf0f1; margin-left: 10px;"></span>
    </div>
    
    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-section">
                <h3>üéØ „ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Ç∑„Éß„É≥</h3>
                <div class="sidebar-item active" onclick="switchMode('chat')">üí¨ „ÉÅ„É£„ÉÉ„Éà</div>
                <div class="sidebar-item" onclick="switchMode('analyze')">üîç „Ç≥„Éº„ÉâÂàÜÊûê</div>
                <div class="sidebar-item" onclick="switchMode('generate')">‚ú® „Ç≥„Éº„ÉâÁîüÊàê</div>
                <div class="sidebar-item" onclick="switchMode('refactor')">üîß „É™„Éï„Ç°„ÇØ„Çø„É™„É≥„Ç∞</div>
            </div>
            
            <div class="sidebar-section">
                <h3>üìù „ÉÜ„É≥„Éó„É¨„Éº„Éà</h3>
                <div class="sidebar-item" onclick="useTemplate('explain')">„Ç≥„Éº„Éâ„ÅÆË™¨Êòé</div>
                <div class="sidebar-item" onclick="useTemplate('debug')">„Éá„Éê„ÉÉ„Ç∞ÊîØÊè¥</div>
                <div class="sidebar-item" onclick="useTemplate('optimize')">ÊúÄÈÅ©ÂåñÊèêÊ°à</div>
                <div class="sidebar-item" onclick="useTemplate('test')">„ÉÜ„Çπ„Éà‰ΩúÊàê</div>
                <div class="sidebar-item" onclick="useTemplate('docs')">„Éâ„Ç≠„É•„É°„É≥„ÉàÁîüÊàê</div>
            </div>
            
            <div class="sidebar-section">
                <h3>‚öôÔ∏è Ë®≠ÂÆö</h3>
                <div class="sidebar-item" onclick="showSettings()">„É¢„Éá„É´ÈÅ∏Êäû</div>
                <div class="sidebar-item" onclick="clearChat()">„ÉÅ„É£„ÉÉ„Éà„ÇØ„É™„Ç¢</div>
            </div>
        </div>
        
        <div class="content">
            <div id="chatMode" class="mode-content">
                <div class="chat-container" id="chatContainer"></div>
                
                <div class="input-container">
                    <div id="statusMessage"></div>
                    <div class="input-wrapper">
                        <textarea id="userInput" placeholder="„Ç≥„Éº„Éâ„Å´„Å§„ÅÑ„Å¶Ë≥™Âïè„Åó„Å¶„Åè„Å†„Åï„ÅÑ..." onkeydown="handleKeyPress(event)"></textarea>
                        <button onclick="sendMessage()" id="sendButton">ÈÄÅ‰ø°</button>
                    </div>
                    <div style="font-size: 12px; color: #666;">
                        Shift+Enter „ÅßÊîπË°å„ÄÅEnter „ÅßÈÄÅ‰ø°
                    </div>
                </div>
            </div>
            
            <div id="codeEditor" class="code-editor">
                <h3 id="editorTitle">„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ</h3>
                <textarea id="codeInput" placeholder="ÂàÜÊûê„Åó„Åü„ÅÑ„Ç≥„Éº„Éâ„ÇíË≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
                <div class="code-actions">
                    <select id="languageSelect">
                        <option value="">Ë®ÄË™û„ÇíËá™ÂãïÊ§úÂá∫</option>
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="cpp">C++</option>
                        <option value="go">Go</option>
                        <option value="rust">Rust</option>
                        <option value="typescript">TypeScript</option>
                        <option value="php">PHP</option>
                        <option value="ruby">Ruby</option>
                    </select>
                    <button onclick="processCode()" id="processButton">ÂÆüË°å</button>
                    <button onclick="switchMode('chat')">„ÉÅ„É£„ÉÉ„Éà„Å´Êàª„Çã</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentMode = 'chat';
        let chatHistory = [];
        let currentModel = 'claude-3-sonnet-20240229';
        
        // API„Ç≠„Éº„ÅÆ‰øùÂ≠ò„Å®Ë™≠„ÅøËæº„Åø
        function loadApiKey() {
            const savedKey = localStorage.getItem('anthropic_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
                showStatus('API„Ç≠„Éº„ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åó„Åü', 'success');
            }
        }
        
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value;
            if (apiKey) {
                localStorage.setItem('anthropic_api_key', apiKey);
                showStatus('API„Ç≠„Éº„Åå‰øùÂ≠ò„Åï„Çå„Åæ„Åó„Åü', 'success');
            }
        }
        
        function getApiKey() {
            return document.getElementById('apiKey').value;
        }
        
        // API„Ç≠„Éº„ÅÆ„ÉÜ„Çπ„Éà
        async function testApiKey() {
            const apiKey = getApiKey();
            if (!apiKey) {
                showStatus('API„Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            try {
                document.getElementById('apiStatus').innerHTML = '<div class="loading"></div>';
                
                const response = await fetch('/api/claude/complete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 10
                    })
                });
                
                if (response.ok) {
                    document.getElementById('apiStatus').textContent = '‚úÖ Êé•Á∂öÊàêÂäü';
                    document.getElementById('apiStatus').style.color = '#27ae60';
                } else {
                    const error = await response.json();
                    document.getElementById('apiStatus').textContent = '‚ùå Êé•Á∂öÂ§±Êïó';
                    document.getElementById('apiStatus').style.color = '#e74c3c';
                    showStatus(`„Ç®„É©„Éº: ${error.error}`, 'error');
                }
            } catch (error) {
                document.getElementById('apiStatus').textContent = '‚ùå Êé•Á∂ö„Ç®„É©„Éº';
                document.getElementById('apiStatus').style.color = '#e74c3c';
                showStatus(`„Ç®„É©„Éº: ${error.message}`, 'error');
            }
        }
        
        // „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            
            setTimeout(() => {
                statusEl.textContent = '';
                statusEl.className = '';
            }, 5000);
        }
        
        // „É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
        function switchMode(mode) {
            currentMode = mode;
            
            // „Çµ„Ç§„Éâ„Éê„Éº„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
            if (mode === 'chat') {
                document.getElementById('chatMode').style.display = 'block';
                document.getElementById('codeEditor').style.display = 'none';
            } else {
                document.getElementById('chatMode').style.display = 'none';
                document.getElementById('codeEditor').style.display = 'block';
                
                // „Ç®„Éá„Ç£„Çø„ÅÆ„Çø„Ç§„Éà„É´„ÇíÊõ¥Êñ∞
                const titles = {
                    'analyze': '„Ç≥„Éº„Éâ„ÇíÂàÜÊûê',
                    'generate': '„Ç≥„Éº„Éâ„ÇíÁîüÊàê',
                    'refactor': '„Ç≥„Éº„Éâ„Çí„É™„Éï„Ç°„ÇØ„Çø„É™„É≥„Ç∞'
                };
                document.getElementById('editorTitle').textContent = titles[mode] || '„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ';
            }
        }
        
        // „É°„ÉÉ„Çª„Éº„Ç∏ÈÄÅ‰ø°
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message) return;
            if (!getApiKey()) {
                showStatus('API„Ç≠„Éº„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            // „É¶„Éº„Ç∂„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇíËøΩÂä†
            addMessage('user', message);
            input.value = '';
            
            // „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = true;
            sendButton.innerHTML = '<div class="loading"></div>';
            
            try {
                const response = await fetch('/api/claude/complete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        apiKey: getApiKey(),
                        messages: chatHistory,
                        model: currentModel,
                        max_tokens: 4096
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const assistantMessage = data.content[0].text;
                    addMessage('assistant', assistantMessage);
                } else {
                    const error = await response.json();
                    showStatus(`„Ç®„É©„Éº: ${error.error}`, 'error');
                }
            } catch (error) {
                showStatus(`„Ç®„É©„Éº: ${error.message}`, 'error');
            } finally {
                sendButton.disabled = false;
                sendButton.textContent = 'ÈÄÅ‰ø°';
            }
        }
        
        // „É°„ÉÉ„Çª„Éº„Ç∏ËøΩÂä†
        function addMessage(role, content) {
            chatHistory.push({ role, content });
            
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${role}`;
            
            const avatar = role === 'user' ? 'üë§' : 'ü§ñ';
            const roleText = role === 'user' ? '„ÅÇ„Å™„Åü' : 'Claude';
            
            // „Ç≥„Éº„Éâ„Éñ„É≠„ÉÉ„ÇØ„ÅÆÂá¶ÁêÜ
            content = content.replace(/```(\w*)\n([\s\S]*?)```/g, (match, lang, code) => {
                const id = 'code-' + Date.now() + Math.random();
                setTimeout(() => {
                    const button = document.getElementById('copy-' + id);
                    if (button) {
                        button.onclick = () => copyCode(code.trim());
                    }
                }, 0);
                return `<pre><code class="${lang}">${escapeHtml(code.trim())}</code><button id="copy-${id}" class="copy-button">„Ç≥„Éî„Éº</button></pre>`;
            });
            
            // „Ç§„É≥„É©„Ç§„É≥„Ç≥„Éº„Éâ„ÅÆÂá¶ÁêÜ
            content = content.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-role">${roleText}</div>
                    <div class="message-text">${content}</div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }
        
        // HTML„Ç®„Çπ„Ç±„Éº„Éó
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        // „Ç≥„Éº„Éâ„Ç≥„Éî„Éº
        function copyCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                showStatus('„Ç≥„Éº„Éâ„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü', 'success');
            });
        }
        
        // „Ç≥„Éº„ÉâÂá¶ÁêÜ
        async function processCode() {
            const code = document.getElementById('codeInput').value;
            const language = document.getElementById('languageSelect').value;
            
            if (!code) {
                showStatus('„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            if (!getApiKey()) {
                showStatus('API„Ç≠„Éº„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            const processButton = document.getElementById('processButton');
            processButton.disabled = true;
            processButton.innerHTML = '<div class="loading"></div>';
            
            try {
                let endpoint, body;
                
                if (currentMode === 'analyze') {
                    endpoint = '/api/claude/analyze-code';
                    body = { apiKey: getApiKey(), code, language };
                } else if (currentMode === 'generate') {
                    endpoint = '/api/claude/generate-code';
                    body = { apiKey: getApiKey(), description: code, language };
                }
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // „ÉÅ„É£„ÉÉ„Éà„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà„Å¶ÁµêÊûú„ÇíË°®Á§∫
                    switchMode('chat');
                    addMessage('user', currentMode === 'analyze' ? `„Ç≥„Éº„Éâ„ÇíÂàÜÊûê„Åó„Å¶„Åè„Å†„Åï„ÅÑ:\n\`\`\`${language}\n${code}\n\`\`\`` : code);
                    addMessage('assistant', data.content[0].text);
                    
                    // „Ç®„Éá„Ç£„Çø„Çí„ÇØ„É™„Ç¢
                    document.getElementById('codeInput').value = '';
                } else {
                    const error = await response.json();
                    showStatus(`„Ç®„É©„Éº: ${error.error}`, 'error');
                }
            } catch (error) {
                showStatus(`„Ç®„É©„Éº: ${error.message}`, 'error');
            } finally {
                processButton.disabled = false;
                processButton.textContent = 'ÂÆüË°å';
            }
        }
        
        // „ÉÜ„É≥„Éó„É¨„Éº„Éà‰ΩøÁî®
        function useTemplate(template) {
            const templates = {
                'explain': '„Åì„ÅÆ„Ç≥„Éº„Éâ„ÇíË©≥„Åó„ÅèË™¨Êòé„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÂêÑÈÉ®ÂàÜ„ÅÆÂΩπÂâ≤„Å®Âãï‰Ωú„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                'debug': '„Åì„ÅÆ„Ç≥„Éº„Éâ„ÅÆ„Éê„Ç∞„ÇíË¶ã„Å§„Åë„Å¶‰øÆÊ≠£ÊñπÊ≥ï„ÇíÊèêÊ°à„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                'optimize': '„Åì„ÅÆ„Ç≥„Éº„Éâ„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÇíÊúÄÈÅ©Âåñ„Åô„ÇãÊñπÊ≥ï„ÇíÊèêÊ°à„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                'test': '„Åì„ÅÆ„Ç≥„Éº„Éâ„Å´ÂØæ„Åô„ÇãÂçò‰Ωì„ÉÜ„Çπ„Éà„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                'docs': '„Åì„ÅÆ„Ç≥„Éº„Éâ„ÅÆ„Éâ„Ç≠„É•„É°„É≥„Éà„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇJSDoc„Åæ„Åü„ÅØÈÅ©Âàá„Å™ÂΩ¢Âºè„Åß„ÄÇ'
            };
            
            document.getElementById('userInput').value = templates[template] || '';
            document.getElementById('userInput').focus();
        }
        
        // „ÉÅ„É£„ÉÉ„Éà„ÇØ„É™„Ç¢
        function clearChat() {
            if (confirm('„ÉÅ„É£„ÉÉ„ÉàÂ±•Ê≠¥„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü')) {
                chatHistory = [];
                document.getElementById('chatContainer').innerHTML = '';
                showStatus('„ÉÅ„É£„ÉÉ„ÉàÂ±•Ê≠¥„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü', 'success');
            }
        }
        
        // „Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            loadApiKey();
            document.getElementById('userInput').focus();
        });
    </script>
</body>
</html>