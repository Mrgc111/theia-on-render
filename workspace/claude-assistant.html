<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Assistant for IDE</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 500;
        }
        
        .api-key-section {
            background-color: #34495e;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .api-key-section label {
            color: white;
            font-size: 14px;
        }
        
        .api-key-section input {
            flex: 1;
            min-width: 300px;
            padding: 8px 12px;
            border: 1px solid #555;
            border-radius: 4px;
            background-color: #2c3e50;
            color: white;
            font-family: monospace;
        }
        
        .api-key-section button {
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .api-key-section button:hover {
            background-color: #2980b9;
        }
        
        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid #ddd;
            overflow-y: auto;
        }
        
        .sidebar-section {
            border-bottom: 1px solid #eee;
        }
        
        .sidebar-section h3 {
            padding: 15px;
            background-color: #f8f9fa;
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }
        
        .sidebar-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px;
        }
        
        .sidebar-item:hover {
            background-color: #f0f0f0;
        }
        
        .sidebar-item.active {
            background-color: #e3f2fd;
            color: #1976d2;
            font-weight: 500;
        }
        
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .message-user .message-avatar {
            background-color: #3498db;
        }
        
        .message-assistant .message-avatar {
            background-color: #9b59b6;
        }
        
        .message-content {
            flex: 1;
        }
        
        .message-role {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #666;
        }
        
        .message-text {
            background-color: #f8f9fa;
            padding: 12px 16px;
            border-radius: 8px;
            line-height: 1.6;
        }
        
        .message-text pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .message-text code {
            background-color: #e8e8e8;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }
        
        .message-text pre code {
            background-color: transparent;
            padding: 0;
        }
        
        .input-container {
            border-top: 1px solid #ddd;
            padding: 20px;
            background-color: #fafafa;
        }
        
        .input-wrapper {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .input-wrapper textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            font-size: 14px;
        }
        
        .input-wrapper button {
            align-self: flex-end;
            padding: 12px 24px;
            background-color: #27ae60;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .input-wrapper button:hover {
            background-color: #229954;
        }
        
        .input-wrapper button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .code-editor {
            display: none;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .code-editor textarea {
            width: 100%;
            min-height: 300px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            background-color: white;
        }
        
        .code-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-message {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .copy-button {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .copy-button:hover {
            background-color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¤– Claude Assistant for IDE</h1>
    </div>
    
    <div class="api-key-section">
        <label for="apiKey">Anthropic API Key:</label>
        <input type="password" id="apiKey" placeholder="sk-ant-api03-..." />
        <button onclick="saveApiKey()">ä¿å­˜</button>
        <button onclick="testApiKey()">æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
        <span id="apiStatus" style="color: #ecf0f1; margin-left: 10px;"></span>
    </div>
    
    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-section">
                <h3>ğŸ¯ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                <div class="sidebar-item active" onclick="switchMode('chat')">ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</div>
                <div class="sidebar-item" onclick="switchMode('analyze')">ğŸ” ã‚³ãƒ¼ãƒ‰åˆ†æ</div>
                <div class="sidebar-item" onclick="switchMode('generate')">âœ¨ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</div>
                <div class="sidebar-item" onclick="switchMode('refactor')">ğŸ”§ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°</div>
            </div>
            
            <div class="sidebar-section">
                <h3>ğŸ“ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h3>
                <div class="sidebar-item" onclick="useTemplate('explain')">ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜</div>
                <div class="sidebar-item" onclick="useTemplate('debug')">ãƒ‡ãƒãƒƒã‚°æ”¯æ´</div>
                <div class="sidebar-item" onclick="useTemplate('optimize')">æœ€é©åŒ–ææ¡ˆ</div>
                <div class="sidebar-item" onclick="useTemplate('test')">ãƒ†ã‚¹ãƒˆä½œæˆ</div>
                <div class="sidebar-item" onclick="useTemplate('docs')">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ</div>
            </div>
            
            <div class="sidebar-section">
                <h3>âš™ï¸ è¨­å®š</h3>
                <div class="sidebar-item" onclick="showSettings()">ãƒ¢ãƒ‡ãƒ«é¸æŠ</div>
                <div class="sidebar-item" onclick="clearChat()">ãƒãƒ£ãƒƒãƒˆã‚¯ãƒªã‚¢</div>
            </div>
        </div>
        
        <div class="content">
            <div id="chatMode" class="mode-content">
                <div class="chat-container" id="chatContainer"></div>
                
                <div class="input-container">
                    <div id="statusMessage"></div>
                    <div class="input-wrapper">
                        <textarea id="userInput" placeholder="ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦è³ªå•ã—ã¦ãã ã•ã„..." onkeydown="handleKeyPress(event)"></textarea>
                        <button onclick="sendMessage()" id="sendButton">é€ä¿¡</button>
                    </div>
                    <div style="font-size: 12px; color: #666;">
                        Shift+Enter ã§æ”¹è¡Œã€Enter ã§é€ä¿¡
                    </div>
                </div>
            </div>
            
            <div id="codeEditor" class="code-editor">
                <h3 id="editorTitle">ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›</h3>
                <textarea id="codeInput" placeholder="åˆ†æã—ãŸã„ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
                <div class="code-actions">
                    <select id="languageSelect">
                        <option value="">è¨€èªã‚’è‡ªå‹•æ¤œå‡º</option>
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="cpp">C++</option>
                        <option value="go">Go</option>
                        <option value="rust">Rust</option>
                        <option value="typescript">TypeScript</option>
                        <option value="php">PHP</option>
                        <option value="ruby">Ruby</option>
                    </select>
                    <button onclick="processCode()" id="processButton">å®Ÿè¡Œ</button>
                    <button onclick="switchMode('chat')">ãƒãƒ£ãƒƒãƒˆã«æˆ»ã‚‹</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentMode = 'chat';
        let chatHistory = [];
        let currentModel = 'claude-3-sonnet-20240229';
        
        // APIã‚­ãƒ¼ã®ä¿å­˜ã¨èª­ã¿è¾¼ã¿
        function loadApiKey() {
            const savedKey = localStorage.getItem('anthropic_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
                showStatus('APIã‚­ãƒ¼ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'success');
            }
        }
        
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value;
            if (apiKey) {
                localStorage.setItem('anthropic_api_key', apiKey);
                showStatus('APIã‚­ãƒ¼ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ', 'success');
            }
        }
        
        function getApiKey() {
            return document.getElementById('apiKey').value;
        }
        
        // APIã‚­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
        async function testApiKey() {
            const apiKey = getApiKey();
            if (!apiKey) {
                showStatus('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            try {
                document.getElementById('apiStatus').innerHTML = '<div class="loading"></div>';
                
                const response = await fetch('/api/claude/complete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 10
                    })
                });
                
                if (response.ok) {
                    document.getElementById('apiStatus').textContent = 'âœ… æ¥ç¶šæˆåŠŸ';
                    document.getElementById('apiStatus').style.color = '#27ae60';
                } else {
                    const error = await response.json();
                    document.getElementById('apiStatus').textContent = 'âŒ æ¥ç¶šå¤±æ•—';
                    document.getElementById('apiStatus').style.color = '#e74c3c';
                    showStatus(`ã‚¨ãƒ©ãƒ¼: ${error.error}`, 'error');
                }
            } catch (error) {
                document.getElementById('apiStatus').textContent = 'âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼';
                document.getElementById('apiStatus').style.color = '#e74c3c';
                showStatus(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            
            setTimeout(() => {
                statusEl.textContent = '';
                statusEl.className = '';
            }, 5000);
        }
        
        // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function switchMode(mode) {
            currentMode = mode;
            
            // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            if (mode === 'chat') {
                document.getElementById('chatMode').style.display = 'block';
                document.getElementById('codeEditor').style.display = 'none';
            } else {
                document.getElementById('chatMode').style.display = 'none';
                document.getElementById('codeEditor').style.display = 'block';
                
                // ã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                const titles = {
                    'analyze': 'ã‚³ãƒ¼ãƒ‰ã‚’åˆ†æ',
                    'generate': 'ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ',
                    'refactor': 'ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°'
                };
                document.getElementById('editorTitle').textContent = titles[mode] || 'ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›';
            }
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message) return;
            if (!getApiKey()) {
                showStatus('APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
            addMessage('user', message);
            input.value = '';
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = true;
            sendButton.innerHTML = '<div class="loading"></div>';
            
            try {
                const response = await fetch('/api/claude/complete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        apiKey: getApiKey(),
                        messages: chatHistory,
                        model: currentModel,
                        max_tokens: 4096
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const assistantMessage = data.content[0].text;
                    addMessage('assistant', assistantMessage);
                } else {
                    const error = await response.json();
                    showStatus(`ã‚¨ãƒ©ãƒ¼: ${error.error}`, 'error');
                }
            } catch (error) {
                showStatus(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                sendButton.disabled = false;
                sendButton.textContent = 'é€ä¿¡';
            }
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
        function addMessage(role, content) {
            chatHistory.push({ role, content });
            
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${role}`;
            
            const avatar = role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';
            const roleText = role === 'user' ? 'ã‚ãªãŸ' : 'Claude';
            
            // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®å‡¦ç†
            content = content.replace(/```(\w*)\n([\s\S]*?)```/g, (match, lang, code) => {
                const id = 'code-' + Date.now() + Math.random();
                setTimeout(() => {
                    const button = document.getElementById('copy-' + id);
                    if (button) {
                        button.onclick = () => copyCode(code.trim());
                    }
                }, 0);
                return `<pre><code class="${lang}">${escapeHtml(code.trim())}</code><button id="copy-${id}" class="copy-button">ã‚³ãƒ”ãƒ¼</button></pre>`;
            });
            
            // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ã®å‡¦ç†
            content = content.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-role">${roleText}</div>
                    <div class="message-text">${content}</div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }
        
        // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        // ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼
        function copyCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                showStatus('ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ', 'success');
            });
        }
        
        // ã‚³ãƒ¼ãƒ‰å‡¦ç†
        async function processCode() {
            const code = document.getElementById('codeInput').value;
            const language = document.getElementById('languageSelect').value;
            
            if (!code) {
                showStatus('ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            if (!getApiKey()) {
                showStatus('APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const processButton = document.getElementById('processButton');
            processButton.disabled = true;
            processButton.innerHTML = '<div class="loading"></div>';
            
            try {
                let endpoint, body;
                
                if (currentMode === 'analyze') {
                    endpoint = '/api/claude/analyze-code';
                    body = { apiKey: getApiKey(), code, language };
                } else if (currentMode === 'generate') {
                    endpoint = '/api/claude/generate-code';
                    body = { apiKey: getApiKey(), description: code, language };
                }
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¦çµæœã‚’è¡¨ç¤º
                    switchMode('chat');
                    addMessage('user', currentMode === 'analyze' ? `ã‚³ãƒ¼ãƒ‰ã‚’åˆ†æã—ã¦ãã ã•ã„:\n\`\`\`${language}\n${code}\n\`\`\`` : code);
                    addMessage('assistant', data.content[0].text);
                    
                    // ã‚¨ãƒ‡ã‚£ã‚¿ã‚’ã‚¯ãƒªã‚¢
                    document.getElementById('codeInput').value = '';
                } else {
                    const error = await response.json();
                    showStatus(`ã‚¨ãƒ©ãƒ¼: ${error.error}`, 'error');
                }
            } catch (error) {
                showStatus(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                processButton.disabled = false;
                processButton.textContent = 'å®Ÿè¡Œ';
            }
        }
        
        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨
        function useTemplate(template) {
            const templates = {
                'explain': 'ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’è©³ã—ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚å„éƒ¨åˆ†ã®å½¹å‰²ã¨å‹•ä½œã‚’æ•™ãˆã¦ãã ã•ã„ã€‚',
                'debug': 'ã“ã®ã‚³ãƒ¼ãƒ‰ã®ãƒã‚°ã‚’è¦‹ã¤ã‘ã¦ä¿®æ­£æ–¹æ³•ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚',
                'optimize': 'ã“ã®ã‚³ãƒ¼ãƒ‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã™ã‚‹æ–¹æ³•ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚',
                'test': 'ã“ã®ã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹å˜ä½“ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚',
                'docs': 'ã“ã®ã‚³ãƒ¼ãƒ‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚JSDocã¾ãŸã¯é©åˆ‡ãªå½¢å¼ã§ã€‚'
            };
            
            document.getElementById('userInput').value = templates[template] || '';
            document.getElementById('userInput').focus();
        }
        
        // ãƒãƒ£ãƒƒãƒˆã‚¯ãƒªã‚¢
        function clearChat() {
            if (confirm('ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                chatHistory = [];
                document.getElementById('chatContainer').innerHTML = '';
                showStatus('ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');
            }
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadApiKey();
            document.getElementById('userInput').focus();
        });
    </script>
</body>
</html>